/*! grace v0.1.0 -pp,-jquery | (c) 2005, 2014 grace Foundation, Inc. | grace.org/license */
!function(a){a([],function(){function a(a,b){a=a.replace(/(^\s*)|(\s*$)/g,"");var c;if(a.indexOf("/")>-1){a=a.split("/");var d;while(d=a.shift()){if("array"!=typeof b[d]&&"object"!=typeof b[d])return;if(b=b[d],a.length>0&&"object"!=typeof b&&"array"!=typeof b[d])return}return b}return b[a]}function b(){this.channels={}}b.prototype={constructor:b,publish:function(b,c){var d=a(b,this.channels);if(d&&d.channels&&d.channels.length)for(var e=d.channels,f,g=0;g<e.length;g++)e[g](c)},subscribe:function(b,c){var d=a(b,this.channels);d?(d=d.channels||(d.channels=[]),d.push(c)):f(b,this.channels,{channels:[c]},1)}};function c(){this.handle={"path1/path2":{all:{}},"path1/path2/":{"delete":{}}}}c.prototype={constructor:c,add:function(a,b,c,d){a=a.replace(/\s/gi,""),"function"==typeof c?(d=c,c="none"):"function"==typeof b&&(d=b,b="all",c="none");var e=this.handle[a]=this.handle[a]||{},f=e[b]||{},g=f[c]||[];g.push(d)},del:function(a,b,c){a=a.replace(/\s/gi,""),b||c?c||(c="none"):(c="none",b="all");var d=this.handle[a];if(d)if("all"==b)if("none"==c)delete this.handle[a];else for(var e in d)delete d[e][c];else"none"==c?delete d[b]:d[b]&&delete d[b][c]},trigger:function(a){var b=a.path.replace(/\s/gi,""),c=a.event,e=a.namespace;e||c?e||(e="none"):(e="none",c="all");var f=b.lastIndexOf("/")==b.length-1;f&&(a.currentPath=b,a.handle=this.handle[b],a.handle&&d(a));var g=b.split("/");f&&g.pop();while(g.length)a.currentPath=g.join("/"),a.handle=this.handle[a.currentPath],a.handle&&d(a),g.pop(),g.length&&(a.currentPath=g.join("/")+"/",a.handle=this.handle[a.currentPath],a.handle&&d(a))}};function d(a){var b=a.handle,c=a.path,d=a.event,e=a.namespace,f,g,h,i;if(b)if("all"==d)if("none"==e){if(g=b.all)for(h in g)g[h].forEach(function(a){a(c)})}else(g=b.all)&&g[e]&&g[e].forEach(function(b){b(c,a)});else if("none"==e){if(g=b[d])for(h in g)g[h].forEach(function(a){oldValue?a(c,oldValue):a(c)});if(g=b.all)for(h in g)g[h].forEach(function(a){a(c,d)})}else(g=b[d])&&g[e]&&g[e].forEach(function(a){a(c,d)}),(g=b.all)&&g[e]&&g[e].forEach(function(a){a(c,d)})}var e=new c;function f(a,b,c,d){if("object"!=typeof b&&"array"!=typeof b)throw new Error("The second arguments need to be an Object or an Array");a=a.replace(/(^\s*)|(\s*$)/g,""),a=a.split("/");var e,f;while(e=a.shift())if(d)b=b[e]=b[e]||{};else if(!b[e]&&a.length)return!1;if("array"==typeof b)b.push(c);else if("object"==typeof b)for(var e in c)b[e]=c[e];return b}function g(a,b){if("object"!=typeof b&&"array"!=typeof b)throw new Error("The second arguments need to be an Object or an Array");a=a.replace(/(^\s*)|(\s*$)/g,""),a=a.split("/");var c=a.pop(),d,e;while(d=a.shift()){if("object"!=typeof b&&"array"!=typeof b)return b?void 0:void 0;b=b[d]}var f=b[c];return delete b[c],f}function h(b,c){b.lastIndexOf("/")==b.length-1&&(b=b.substr(0,b.length-1)),this.PATH=b,this._dataset_=a(b,c)}h.prototype={get:function(b){return b?a(b,this._dataset_):this._dataset_},trigger:function(a,b){if(b){var c=b.split("."),d;b=c.shift(),c.length&&(d=c.join(".")),e.trigger({path:this.PATH+"/"+a,event:b,namespace:d||"none"})}},on:function(a,b,c,d){e.add(this.PATH+"/"+a,b,c,d)},off:function(a,b,c){e.del(this.PATH+"/"+a,b,c)},"delete":function(a){var b=g(a,this.dataset),c=i(b);e.trigger({path:this.PATH+"/"+a,event:"delete",namespace:"none",oldValue:c})},set:function(b,c){var d=a(b,this.dataset),g=i(d),h=d?"update":"create";c=f(b,this.dataset,c,1),e.trigger({path:this.PATH+"/"+b,event:h,namespace:"none",newValue:c,oldValue:g})}};function i(a){return JSON.parse(JSON.stringify(a))}function j(){this.dataset={},this.handlers={}}j.prototype={initData:function(a,b){return b?(b=i(b),f(a,this.dataset,b,1)):void 0},getDS:function(a){return new h(a,this.dataset)},trigger:function(a,b){if(b){var c=b.split("."),d;b=c.shift(),c.length&&(d=c.join(".")),e.trigger({path:a,event:b,namespace:d||"none"})}},on:function(a,b,c,d){e.add(a,b,c,d)},off:function(a,b,c){e.del(a,b,c)},"delete":function(a){var b=g(a,this.dataset),c=i(b);e.trigger({path:a,event:"delete",namespace:"none",oldValue:c})},set:function(b,c){var d=a(b,this.dataset),g=i(d),h=d?"update":"create";c=f(b,this.dataset,c,1),e.trigger({path:b,event:h,namespace:"none",newValue:c,oldValue:g})}};function k(){this.routers={},window.addEventListener("hashchange",function(a){l(a)},!1)}function l(a){var b=a.newURL,c=a.oldURL,d;if(window.location.hash&&(d=decodeURI(window.location.hash).substr(1)),d){var e=d.split("/"),f,g,f,h,i;while(i=e.pop())i.indexOf("!")>-1?(g=i.indexOf("!"),f=i.substr(0,g),h=i.substr(g+1)):f=i,n.MD.publish(f,h)}}function m(){this.widget={},this.page={},this.extend={},this.chips={},this.DS=new j,this.MD=new b,new k}m.prototype={Extend:function(a,b){if(a&&(a=a.replace(/\s/gi,""))){var c=a.split(",");while(a=c.pop())if("grace"==a.toLowerCase())for(var d in b)m.prototype[d]=b[d];else{var e=this.extend[a]||(this.extend[a]={});for(var d in b)e[d]=b[d]}}}},window.G||(window.G=new m);var n=window.G;function o(a){this.core=null,this.length=0,this.$(a)}var p=function(a){return new o(a)};p.fn=o.prototype,n.Extend("grace",{Engine:function(a,b){if(a)for(var c in a)p.fn[c]=a[c];if(b)for(var c in b)p[c]=b[c]},$:p}),n.Engine({z_freshCore:function(){var a=0,b=this.core;while(b[a])this[a]=b[a],a++;this.length=b.length}},{extend:function(a){for(var b in a)(function(a,b){p.fn[a]=b})(b,a[b])}});var q={},r=Array.prototype,s=Object.prototype,t=Function.prototype,u=r.push,v=r.slice,w=r.concat,x=s.toString,y=s.hasOwnProperty,z=r.forEach,A=r.map,B=r.reduce,C=r.reduceRight,D=r.filter,E=r.every,F=r.some,G=r.indexOf,H=r.lastIndexOf,I=Array.isArray,J=Object.keys,K=t.bind,L=function(a){return a instanceof L?a:this instanceof L?void(this._wrapped=a):new L(a)},M=L.each=function(a,b,c){if(null!=a)if(z&&a.forEach===z)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===q)return}else for(var f in a)if(L.hasKey(a,f)&&b.call(c,a[f],f,a)===q)return};L.map=function(a,b,c){var d=[];return null==a?d:A&&a.map===A?a.map(b,c):(M(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},L.find=function(a,b,c){var d;return N(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},L.filter=function(a,b,c){var d=[];return null==a?d:D&&a.filter===D?a.filter(b,c):(M(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)};var N=function(a,b,c){b||(b=L.identity);var d=!1;return null==a?d:F&&a.some===F?a.some(b,c):(M(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?q:void 0}),!!d)};L.contains=function(a,b){return null==a?!1:G&&a.indexOf===G?-1!=a.indexOf(b):N(a,function(a){return a===b})},L.pluck=function(a,b){return L.map(a,function(a){return a[b]})},L.where=function(a,b,c){return L.isEmpty(b)?c?null:[]:L[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},L.findWhere=function(a,b){return L.where(a,b,!0)},L.size=function(a){return null==a?0:a.length===+a.length?a.length:L.keys(a).length},L.without=function(a){return L.difference(a,v.call(arguments,1))},L.uniq=L.unique=function(a,b,c,d){L.isFunction(b)&&(d=c,c=b,b=!1);var e=c?L.map(a,c,d):a,f=[],g=[];return M(e,function(c,d){(b?d&&g[g.length-1]===c:L.contains(g,c))||(g.push(c),f.push(a[d]))}),f},L.union=function(){return L.uniq(w.apply(r,arguments))},L.difference=function(a){var b=w.apply(r,v.call(arguments,1));return L.filter(a,function(a){return!L.contains(b,a)})},L.delay=function(a,b){var c=v.call(arguments,2);return setTimeout(function(){return a(c)},b)},L.defer=function(a){return L.delay.apply(L,[a,1].concat(v.call(arguments,1)))},L.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},L.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},L.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},L.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},L.keys=J||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)L.hasKey(a,c)&&(b[b.length]=c);return b},L.values=function(a){var b=[];for(var c in a)L.hasKey(a,c)&&b.push(a[c]);return b},L.extend=function(a){return M(v.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},L.pick=function(a){var b={},c=w.apply(r,v.call(arguments,1));return M(c,function(c){c in a&&(b[c]=a[c])}),b},L.omit=function(a){var b={},c=w.apply(r,v.call(arguments,1));for(var d in a)L.contains(c,d)||(b[d]=a[d]);return b},L.clone=function(a){return L.isObject(a)?L.isArray(a)?a.slice():L.extend({},a):a},L.tap=function(a,b){return b(a),a},L.isEmpty=function(a){if(null==a)return!0;if(L.isArray(a)||L.isString(a))return 0===a.length;for(var b in a)if(L.hasKey(a,b))return!1;return!0},L.isElement=function(a){return!(!a||1!==a.nodeType)},L.isArray=I||function(a){return"[object Array]"==x.call(a)},L.isObject=function(a){return a===Object(a)},M(["Arguments","Function","String","Number","Date","RegExp"],function(a){L["is"+a]=function(b){return x.call(b)=="[object "+a+"]"}}),L.isArguments(arguments)||(L.isArguments=function(a){return!(!a||!L.hasKey(a,"callee"))}),"function"!=typeof/./&&(L.isFunction=function(a){return"function"==typeof a}),L.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},L.isNaN=function(a){return L.isNumber(a)&&a!=+a},L.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==x.call(a)},L.isNull=function(a){return null===a},L.isUndefined=function(a){return void 0===a},L.hasKey=function(a,b){return y.call(a,b)},L.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var O=0;L.uniqueId=function(a){var b=++O+"";return a?a+b:b}})("undefined"!=typeof a?a:function(a,b){"undefined"!=typeof module?module.exports=b():Compose=b();function c(a,b){return a.replace(/(^\s*)|(\s*$)/g,"").replace(/\{.*?\}/gi,function(a){return b[a.replace(/\{|\}/gi,"")]})}var d={};function e(a,b,c,e){var f=this;function g(d){if(this.INHERIT){var g=this.base=new G.widget[this.INHERIT](d);for(var h in g)g.hasOwnProperty(h)&&(this[h]=g[h])}b.call(this,d);for(var h in c)if("init"!=h){var i=G.extend[e.TYPE+"/behavior"][h];i&&(i=i[0],i&&i.call(this,a,c[h],f))}var j=c.init;"page"==e.TYPE&&G.extend[e.TYPE+"/behavior"].init[0].call(this,a,c.init,f)}g.prototype.PATH=a,d.path&&(g.prototype[d.type]=d.path,"REBUILT"==d.type&&(g.prototype.baseProto=G.chips[d.path].proto),d.path=null);var h=this.extend[e.TYPE];for(var i in h)g.prototype[i]=h[i];for(var i in c){var j=G.extend[e.TYPE+"/behavior"][i];j&&(j=j[1],j&&j.call(this,a,c[i],e))}for(var i in e)g.prototype[i]=e[i];return g}function f(a){if(!a)return a;var b=[Number,String,Boolean],c;if(b.forEach(function(b){a instanceof b&&(c=b(a))}),"undefined"==typeof c)if("[object Array]"===Object.prototype.toString.call(a))c=[],a.forEach(function(a,b,d){c[b]=f(a)});else if("object"==typeof a)if(a.nodeType&&"function"==typeof a.cloneNode)var c=a.cloneNode(!0);else if(a.prototype)c=a;else{c={};for(var d in a)c[d]=f(a[d])}else c=a;return c}G.Extend("grace",{Widget:function(a,b,c,f){if(f.TYPE="widget",d.path){var g=this.widget[d.path],h=this.chips[d.path],i;i="*"==d.options?Object.keys(G.extend["widget/behavior"]):d.options;for(var j={},k=0,l=i.length;l>k;k++)j[i[k]]=_.extend({},h.behavior[i[k]],c[i[k]]);c=_.extend({},c,j),f=_.extend({},h.proto,b.prototype,f)}this.chips[a]={path:a,func:b,behavior:c,proto:f},this.widget[a]=e.call(this,a,b,c,f)}}),G.Extend("widget,page",{DS:function(a){return G.DS.getDS(a)},$:function(a){return $$(a)},publish:function(a,b){b?G.MD.publish(a,b):G.MD.publish(a)},"new":function(a,b){var c=this.widget[a];return"widget"==this.TYPE&&c&&this.PATH.split("/")[0]==a.split("/")[0]||"widget"!=this.TYPE&&c?new c(b):void 0}}),G.Extend("widget/behavior,page/behavior",{dataset:[function(a,b,d){var e=d.DS;b=f(b),b.constructor==Array&&(b[0]=c(b[0],this)),e.initData(a,b)},function(){}],util:[function(a,b,c){g(b,this)},function(a,b,c){}],event:[function(a,b,c){for(var d in b)i(this,d)},function(a,b,c){for(var d in b)c["zzE_"+d]=b[d]}],subscribe:[function(a,b,c){for(var d in b)h(this,d)},function(a,b,c){for(var d in b)c["zzS_"+d]=b[d]}],init:[function(a,b,d){for(var e in b)b[e].constructor==String?j(this,c(e,this),this[b[e]]):j(this,c(e,this),b[e])},function(a,b,c){}]}),G.Extend("widget/behavior/event,page/behavior/event",{event:function(a,b,c){var d=b.indexOf(" "),e=b.substr(0,d),f=b.substr(d+1).split("@");2==f.length?$$(f[0]).on(e,f[1],function(b){a[c]($$(this),b)}):1==f.length&&$$(f[0]).on(e,function(b){a[c]($$(this),b)})}}),G.Extend("widget/behavior/init,page/behavior/init",{dom:function(a,b,c){var d=$$(b),e=d.data("set");e.constructor==String&&(e=G.DS.getDS(e)),c.call(a,d,e)}});function g(a,b){var d={},e={};for(var f in a)f=c(f,b),f.indexOf(":")>-1?e[f]=a[f]:d[f]=a[f];G.Util(e,d)}function h(a,b){var d="zzS_"+b;b=c(b,a),a[d].constructor==String&&(d=a[d]),G.MD.subscribe(b,function(b){a[d](b)})}function i(a,b){var d="zzE_"+b;a[d].constructor==String&&(d=a[d]),b=c(b,a);var e=b.indexOf(" "),f=b.indexOf(":");if(e>0&&(f>0&&f>e||-1==f))var g="event";else if(f>0&&(e>0&&e>f||-1==e))var g=b.substr(0,f),b=b.substr(f+1);G.extend[a.TYPE+"/behavior/event"][g](a,b,d)}function j(a,b,c){if(b.indexOf(":")>-1){var d=b.indexOf(":"),e=b.substr(0,d),f=b.substr(d+1),g=G.extend[a.TYPE+"/behavior/init"][e];g?g(a,f,c):G.extend[a.TYPE+"/behavior/init"].dom(a,b,c)}else G.extend[a.TYPE+"/behavior/init"].dom(a,b,c)}return G.Extend("grace",{Page:function(a,b,c,d){d.TYPE="page",this.page[a]=e.call(this,a,b,c,d)}}),G.Extend("page",{init:function(a,b){var c=this.page[a];return"page"==this.TYPE&&c&&this.PATH.split("/")[0]==a.split("/")[0]?new c(b):void 0}}),G.Extend("grace",{Util:function(a,b){$$.extend(b);var c=$$.dataUtils;for(var d in a)if(d.indexOf(":")>-1){var e=d.split(":");c[e[0]]=c[e[0]]||{},c[e[0]][e[1]]=a[d]}else c.util=c.util||{},c.util[d]=a[d]}}),G.Engine({util:function(a){var b=$$.dataUtils;if(a&&a.constructor==String){a=a.replace(/\s/gi,"").split(",");var c,d,e=b.util;while(c=a.pop()){var f=e[c];this.find('[data-util="'+c+'"]').each(function(a){!a[0].inited&&f&&(f(a,a.data("set")),a[0].inited=!0)}).end()}}else for(d in b){var g=b[d];this.find("[data-"+d+"]").each(function(a){var b=a.data(d);!a[0].inited&&g[b]&&(g[b](a,a.data("set")),a[0].inited=!0)}).end()}return this}},{dataUtils:{}}),G.Extend("grace",{App:function(a,b){var c,d;a&&a();for(d in this.page)-1==d.indexOf("/")&&(c=this.page[d],c&&new c);b&&b()}}),G})}("undefined"!=typeof define?define:function(a,b){"undefined"!=typeof module?module.exports=b():window.G=b()});
//# sourceMappingURL=grace.min.map