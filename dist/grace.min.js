/*! grace v0.1.0 -jquery | (c) 2005, 2014 grace Foundation, Inc. | grace.org/license */
!function(a){a([],function(){function a(){this.channels={}}a.prototype={constructor:a,publish:function(a,b){var c=d(a,this.channels);if(c&&c.channels&&c.channels.length)for(var e=c.channels,f,g=0;g<e.length;g++)e[g](b)},subscribe:function(a,b){var c=d(a,this.channels,1);c=c.channels||(c.channels=[]),c.push(b)}};function b(){this.handle={"path1/path2":{all:{namespace:[callback1,callback2]}},"path1/path2/":{"delete":{namespace:[callback1,callback2]}}}}b.prototype={constructor:b,add:function(a,b,c,d){3==arguments.length&&(d=c,c="none");var e=this.handle[a]=this.handle[a]||{},f=e[b]||{},g=f[c]||[];g.push(d)},del:function(a,b,c){2==arguments.length?c="none":1==arguments.length&&(c="none",b="all");var d=this.handle[a];if(d)if("all"==b)if("none"==c)delete this.handle[a];else for(var e in d)delete d[e][c];else"none"==c?delete d[b]:d[b]&&delete d[b][c]},trigger:function(a,b,d){if(a=a.replace(/\s/gi,""),2==arguments.length?d="none":1==arguments.length&&(d="none",b="all"),a.lastIndexOf("/")==a.length-1)c(this.handle,a,b,d);else{var e=a.split("/");while(e.length)c(this.handle,e.join("/"),b,d),e.pop()}}};function c(a,b,c,d){var e=a[b],f,g,h,i;if(e)if("all"==c)if("none"==d){for(i in e)if(g=e[i])for(h in g)g[h].forEach(function(a){a(b,c)})}else(g=e["delete"])&&g[d]&&g[d].forEach(function(a){a(b,c)});else if("none"==d)if(g=e[c])for(h in g)g[h].forEach(function(a){a(b,c)});else(g=e[c])&&g[d]&&g[d].forEach(function(a){a(b,c)})}function d(a,b,c){a=a.replace(/(^\s*)|(\s*$)/g,"");var d;if(a.indexOf("/")>-1){a=a.split("/");var e;while(e=a.shift())if("undefined"!=typeof b[e]){if(b=b[e],a.length>0&&"object"!=typeof b)throw new Error("The "+e+" related to the node of Object is not an Object type")}else{if(!c)return;if(!a.length)return b[e]={},b[e];b=b[e]={}}return b}return"undefined"!=typeof b[a]?b[a]:c?(b[a]={},b[a]):void 0}function e(a,b){this.PATH=a,this._dataset_=d(a,b,1)}e.prototype={get:function(a){return a=a.replace(/\s/gi,""),a?a.indexOf("/")>-1?d(a,this._dataset_):this._dataset_[a]:this._dataset_},set:function(a,b){var c;if(b.constructor==Object){c=a.indexOf("/")>-1?d(a,this._dataset_,1):this._dataset_[a];for(var e in b)b.hasOwnProperty(e)&&(c[a]=b[e])}else{if(a.indexOf("/")>-1){a=a.replace(/\s/gi,"").split("/");var f=a.pop();a.length>1?c=d(a.join("/"),this._dataset_,1):1==a.length&&(c=this._dataset_[a[0]])}else c=this._dataset_;c[a]=b}},"delete":function(a){var b=this.PATH+"/"+a;a=a.replace(/\s/gi,"").split("/");var c=a.pop();a=a.join("/"),a?a.indexOf("/")>-1?(delete d(a,this._dataset_)[c],e(this.handlers[b],b)):delete this._dataset_[a][c]:delete this._dataset_[c];function e(a,b){if(a)for(var c in a)(0==c.indexOf("delete")||0==c.indexOf("all"))&&a[c]()}},bind:function(a,b,c){a.constructor==Function?(callback=a,a=this.PATH,b="all"):b.constructor==Function&&(callback=b,"|update|delete|create|".indexOf("|"+a.split(".")[0]+"|")>-1?(b=a,a=this.PATH):(b="all",a=this.PATH+"/"+a));for(var d in c){var e=this.handlers[a]=this.handlers[a]||{};e=e[b]=e[b]||[],e.push(c)}},unbind:function(a,b){if("|update|delete|create|".indexOf("|"+a.split(".")[0]+"|")>-1?(b=a,a=this.PATH):(b="all",a=this.PATH+"/"+a),"all"==b)delete this.handlers[a];else{var c=this.handlers[a];for(var d in c)0==d.indexOf(b)&&delete c[d]}},trigger:function(a,b,c,d){}};function f(a){if(!a)return a;var b=[Number,String,Boolean],c;if(b.forEach(function(b){a instanceof b&&(c=b(a))}),"undefined"==typeof c)if("[object Array]"===Object.prototype.toString.call(a))c=[],a.forEach(function(a,b,d){c[b]=clone(a)});else if("object"==typeof a)if(a.nodeType&&"function"==typeof a.cloneNode)var c=a.cloneNode(!0);else if(a.prototype)c=a;else{c={};for(var d in a)c[d]=clone(a[d])}else c=a;return c}function g(){this.dataset={},this.handlers={}}g.prototype={initData:function(a,b){if(b){b=f(b);var c=d(a,this.dataset,1);if(b.constructor==Array)c[b[0]]=b[1];else if(b.constructor==Object)for(var e in b)b.hasOwnProperty(e)&&(c[e]=b[e])}},getDS:function(a){return new e(a,this.dataset)},trigger:function(a,b,c,d){}};function h(){this.widget={},this.page={},this.extend={},this.DS=new g,this.MD=new a,new Router}h.prototype={Extend:function(a,b){if(a&&(a=a.replace(/\s/gi,""))){var c=a.split(",");while(a=c.pop())if("grace"==a.toLowerCase())for(var d in b)h.prototype[d]=b[d];else{var e=this.extend[a]||(this.extend[a]={});for(var d in b)e[d]=b[d]}}}};var i=window.G=new h;function j(a){this.core=null,this.length=0,this.$(a)}function k(a){return new j(a)}i.Extend("grace",{Engine:function(a,b){if(a)for(var c in a)j.prototype[c]=a[c];if(b)for(var c in b)$[c]=b[c]}}),i.Engine({z_freshCore:function(){var a=0,b=this.core;while(b[a])this[a]=b[a],a++;this.length=b.length}});function l(){}var m=Object.create?function(a){return Object.create("function"==typeof a?a.prototype:a||Object.prototype)}:function(a){l.prototype="function"==typeof a?a.prototype:a;var b=new l;return l.prototype=null,b};function n(a){if(!a)throw new Error("Compose arguments must be functions or objects");return a}function o(a,b,c){for(var d,e=b.length;e>c;c++){var f=b[c];if("function"==typeof f){var g=f.prototype;for(var h in g){d=g[h];var i=g.hasOwnProperty(h);if("function"==typeof d&&h in a&&d!==a[h]){var j=a[h];d==u?d=j:i||(p(d,h,x([].slice.call(b,0,c),!0))?d=j:p(j,h,x([f],!0))||console.error("Conflicted method "+h+", final composer must explicitly override with correct method."))}d&&d.install&&i&&!p(j,h,x([f],!0))?d.install.call(a,h):a[h]=d}}else for(var h in n(f)){var d=f[h];if("function"==typeof d){if(d.install){d.install.call(a,h);continue}if(h in a&&d==u)continue}a[h]=d}}return a}w._setMixin=function(a){o=a};function p(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[b]==a)return!0}}function q(a,b){function c(){if(b)return b.apply(this,arguments);throw new Error("Decorator not applied")}return c.install=a,c}w.Decorator=q;function r(a){return function(b){return q(function c(d){var e=this[d];(b=this[d]=e?a(this,e,b):b).install=c},b)}}w.around=r(function(a,b,c){return c.call(a,b)}),w.before=r(function(a,b,c){return function(){var a=c.apply(this,arguments);return a!==s?b.apply(this,a||arguments):void 0}});var s=w.stop={},t;w.after=r(function(a,b,c){return function(){var a=b.apply(this,arguments),d=c.apply(this,arguments);return d===t?a:d}}),w.from=function(a,b){return b?("function"==typeof a?a.prototype:a)[b]:q(function(c){if(!(this[c]="string"==typeof a?this[a]:("function"==typeof a?a.prototype:a)[b||c]))throw new Error("Source method "+b+" was not available to be renamed to "+c)})},w.create=function(a){for(var b=o(m(a),arguments,1),c=arguments.length,d=0;c>d;d++){var e=arguments[d];"function"==typeof e&&(b=e.call(b)||b)}return b};function u(){throw new Error("This method is required and no implementation has been provided")}w.required=u;function v(){var a=[this];return a.push.apply(a,arguments),w.apply(0,a)}function w(a){var b=arguments,c=b.length<2&&"function"!=typeof b[0]?b[0]:o(m(n(a)),b,1);function d(){var a;this instanceof d?a=this:(l.prototype=c,a=new l);for(var b=0;f>b;b++){var g=e[b],h=g.apply(a,arguments);if("object"==typeof h)if(h instanceof d)a=h;else for(var i in h)h.hasOwnProperty(i)&&(a[i]=h[i])}return a}d._getBases=function(a){return a?g:e};var e=x(b),f=e.length;"object"==typeof b[b.length-1]&&(b[b.length-1]=c);var g=x(b,!0);return d.extend=v,w.secure||(c.constructor=d),d.prototype=c,d}w.apply=function(a,b){return a?o(a,b,0):v.apply.call(w,0,b)},w.call=function(a){return o(a,arguments,1)};function x(a,b){var c=[];function d(a,e){a:for(var f=0;f<a.length;f++){var g=a[f],h=b&&"function"==typeof g?g.prototype:g;if(b||"function"==typeof g){var i=e&&g._getBases;if(i)d(i(b));else{for(var j=0;j<c.length;j++)if(h==c[j])continue a;c.push(h)}}}}return d(a,!0),c}function y(a,b){return a.replace(/(^\s*)|(\s*$)/g,"").replace(/\{.*?\}/gi,function(a){return b[a.replace(/\{|\}/gi,"")]})}i.Extend("grace",{Widget:function(a,b,c,d){d.TYPE="widget",this.widget[a]=D.call(this,a,b,c,d)}}),i.Extend("widget,page",{DS:function(a){return i.DS.getDS(a)},$:function(a){return k(a)},publish:function(a,b){b?i.MD.publish(a,b):i.MD.publish(a)},"new":function(a,b){var c=this.widget[a];return"widget"==this.TYPE&&c&&this.PATH.split("/")[0]==a.split("/")[0]||"widget"!=this.TYPE&&c?new c(b):void 0}}),i.Extend("widget/behavior,page/behavior",{dataset:[function(a,b,c){var d=c.DS;b=clone(b),b.constructor==Array&&(b[0]=y(b[0],this)),d.initData(a,b)},function(){}],util:[function(a,b,c){z(b,this)},function(a,b,c){}],event:[function(a,b,c){for(var d in b)B(this,d)},function(a,b,c){for(var d in b)c["zzE_"+d]=b[d]}],subscribe:[function(a,b,c){for(var d in b)A(this,d)},function(a,b,c){for(var d in b)c["zzS_"+d]=b[d]}],init:[function(a,b,c){for(var d in b)b[d].constructor==String?C(this,y(d,this),this[b[d]]):C(this,y(d,this),b[d])},function(a,b,c){}]}),i.Extend("widget/behavior/event,page/behavior/event",{event:function(a,b,c){var d=b.indexOf(" "),e=b.substr(0,d),f=b.substr(d+1).split("@");2==f.length?k(f[0]).on(e,f[1],function(b){a[c](k(this),b)}):1==f.length&&k(f[0]).on(e,function(b){a[c](k(this),b)})}}),i.Extend("widget/behavior/init,page/behavior/init",{dom:function(a,b,c){var d=k(b),e=d.data("set");e.constructor==String&&(e=i.DS.getDS(e)),c.call(a,d,e)}});function z(a,b){var c={},d={};for(var e in a)e=y(e,b),e.indexOf(":")>-1?d[e]=a[e]:c[e]=a[e];i.Util(d,c)}function A(a,b){var c="zzS_"+b;b=y(b,a),a[c].constructor==String&&(c=a[c]),i.MD.subscribe(b,function(b){a[c](b)})}function B(a,b){var c="zzE_"+b;a[c].constructor==String&&(c=a[c]),b=y(b,a);var d=b.indexOf(" "),e=b.indexOf(":");if(d>0&&(e>0&&e>d||-1==e))var f="event";else if(e>0&&(d>0&&d>e||-1==d))var f=b.substr(0,e),b=b.substr(e+1);i.extend[a.TYPE+"/behavior/event"][f](a,b,c)}function C(a,b,c){if(b.indexOf(":")>-1){var d=b.indexOf(":"),e=b.substr(0,d),f=b.substr(d+1),g=i.extend[a.TYPE+"/behavior/init"][e];g?g(a,f,c):i.extend[a.TYPE+"/behavior/init"].dom(a,b,c)}else i.extend[a.TYPE+"/behavior/init"].dom(a,b,c)}function D(a,b,c,d){var e=this;function f(){b.apply(this,arguments);for(var f in c)if("init"!=f){var g=i.extend[d.TYPE+"/behavior"][f];g&&(g=g[0],g&&g.call(this,a,c[f],e))}var h=c.init;"page"==d.TYPE&&i.extend[d.TYPE+"/behavior"].init[0].call(this,a,c.init,e)}d.PATH=a;var g=this.extend[d.TYPE];for(var h in g)d[h]=g[h];for(var h in c){var j=i.extend[d.TYPE+"/behavior"][h];j&&(j=j[1],j&&j.call(this,a,c[h],d))}return w(f,d)}return i.Extend("grace",{Page:function(a,b,c,d){d.TYPE="page",this.page[a]=D.call(this,a,b,c,d)}}),i.Extend("page",{init:function(a,b){var c=this.page[a];return"page"==this.TYPE&&c&&this.PATH.split("/")[0]==a.split("/")[0]?new c(b):void 0}}),i.Extend("grace",{Util:function(a,b){k.extend(b);var c=k.dataUtils;for(var d in a)if(d.indexOf(":")>-1){var e=d.split(":");c[e[0]]=c[e[0]]||{},c[e[0]][e[1]]=a[d]}else c.util=c.util||{},c.util[d]=a[d]}}),i.Engine({util:function(a){var b=k.dataUtils;if(a&&a.constructor==String){a=a.replace(/\s/gi,"").split(",");var c,d,e=b.util;while(c=a.pop()){var f=e[c];this.find('[data-util="'+c+'"]').each(function(a){!a[0].inited&&f&&(f(a,a.data("set")),a[0].inited=!0)}).end()}}else for(d in b){var g=b[d];this.find("[data-"+d+"]").each(function(a){var b=a.data(d);!a[0].inited&&g[b]&&(g[b](a,a.data("set")),a[0].inited=!0)}).end()}return this}},{dataUtils:{}}),i.Extend("grace",{App:function(a,b){var c,d;a&&a();for(d in this.page)-1==d.indexOf("/")&&(c=this.page[d],c&&new c);b&&b()}}),i})}("undefined"!=typeof define?define:function(a,b){"undefined"!=typeof module?module.exports=b():window.Compose=b()});
//# sourceMappingURL=grace.min.map