/*! grace v0.1.0 -pp,-jquery | (c) 2005, 2014 grace Foundation, Inc. | grace.org/license */
!function(a){a([],function(){function a(a,b,c){a=a.replace(/(^\s*)|(\s*$)/g,"");var d;if(a.indexOf("/")>-1){a=a.split("/");var e;while(e=a.shift())if("undefined"!=typeof b[e]){if(b=b[e],a.length>0&&"object"!=typeof b)throw new Error("The "+e+" related to the node of Object is not an Object type")}else{if(!c)return;if(!a.length)return b[e]={},b[e];b=b[e]={}}return b}return"undefined"!=typeof b[a]?b[a]:c?(b[a]={},b[a]):void 0}function b(){this.channels={}}b.prototype={constructor:b,publish:function(b,c){var d=a(b,this.channels);if(d&&d.channels&&d.channels.length)for(var e=d.channels,f,g=0;g<e.length;g++)e[g](c)},subscribe:function(b,c){var d=a(b,this.channels,1);d=d.channels||(d.channels=[]),d.push(c)}};function c(){this.handle={"path1/path2":{all:{}},"path1/path2/":{"delete":{}}}}c.prototype={constructor:c,add:function(a,b,c,d){3==arguments.length&&(d=c,c="none");var e=this.handle[a]=this.handle[a]||{},f=e[b]||{},g=f[c]||[];g.push(d)},del:function(a,b,c){2==arguments.length?c="none":1==arguments.length&&(c="none",b="all");var d=this.handle[a];if(d)if("all"==b)if("none"==c)delete this.handle[a];else for(var e in d)delete d[e][c];else"none"==c?delete d[b]:d[b]&&delete d[b][c]},trigger:function(a,b,c){if(a=a.replace(/\s/gi,""),2==arguments.length?c="none":1==arguments.length&&(c="none",b="all"),a.lastIndexOf("/")==a.length-1)d(this.handle,a,b,c);else{var e=a.split("/");while(e.length)d(this.handle,e.join("/"),b,c),e.pop()}}};function d(a,b,c,d){var e=a[b],f,g,h,i;if(e)if("all"==c)if("none"==d){for(i in e)if(g=e[i])for(h in g)g[h].forEach(function(a){a(b,c)})}else(g=e["delete"])&&g[d]&&g[d].forEach(function(a){a(b,c)});else if("none"==d)if(g=e[c])for(h in g)g[h].forEach(function(a){a(b,c)});else(g=e[c])&&g[d]&&g[d].forEach(function(a){a(b,c)})}var e=new c;function f(b,c){this.PATH=b,this._dataset_=a(b,c,1)}f.prototype={get:function(b){return b=b.replace(/\s/gi,""),b?b.indexOf("/")>-1?a(b,this._dataset_):this._dataset_[b]:this._dataset_},set:function(b,c){var d;if(c.constructor==Object){d=b.indexOf("/")>-1?a(b,this._dataset_,1):this._dataset_[b];for(var e in c)c.hasOwnProperty(e)&&(d[b]=c[e])}else{if(b.indexOf("/")>-1){b=b.replace(/\s/gi,"").split("/");var f=b.pop();b.length>1?d=a(b.join("/"),this._dataset_,1):1==b.length&&(d=this._dataset_[b[0]])}else d=this._dataset_;d[b]=c}},"delete":function(b){var c=this.PATH+"/"+b;b=b.replace(/\s/gi,"").split("/");var d=b.pop();b=b.join("/"),b?b.indexOf("/")>-1?(delete a(b,this._dataset_)[d],e(this.handlers[c],c)):delete this._dataset_[b][d]:delete this._dataset_[d];function e(a,b){if(a)for(var c in a)(0==c.indexOf("delete")||0==c.indexOf("all"))&&a[c]()}},bind:function(a,b,c){a.constructor==Function?(callback=a,a=this.PATH,b="all"):b.constructor==Function&&(callback=b,"|update|delete|create|".indexOf("|"+a.split(".")[0]+"|")>-1?(b=a,a=this.PATH):(b="all",a=this.PATH+"/"+a));for(var d in c){var e=this.handlers[a]=this.handlers[a]||{};e=e[b]=e[b]||[],e.push(c)}},unbind:function(a,b){if("|update|delete|create|".indexOf("|"+a.split(".")[0]+"|")>-1?(b=a,a=this.PATH):(b="all",a=this.PATH+"/"+a),"all"==b)delete this.handlers[a];else{var c=this.handlers[a];for(var d in c)0==d.indexOf(b)&&delete c[d]}},trigger:function(a,b,c,d){}};function c(){this.handle={"path1/path2":{all:{}},"path1/path2/":{"delete":{}}}}c.prototype={constructor:c,add:function(a,b,c,d){3==arguments.length&&(d=c,c="none");var e=this.handle[a]=this.handle[a]||{},f=e[b]||{},g=f[c]||[];g.push(d)},del:function(a,b,c){2==arguments.length?c="none":1==arguments.length&&(c="none",b="all");var d=this.handle[a];if(d)if("all"==b)if("none"==c)delete this.handle[a];else for(var e in d)delete d[e][c];else"none"==c?delete d[b]:d[b]&&delete d[b][c]},trigger:function(a,b,c){if(a=a.replace(/\s/gi,""),2==arguments.length?c="none":1==arguments.length&&(c="none",b="all"),a.lastIndexOf("/")==a.length-1)d(this.handle,a,b,c);else{var e=a.split("/");while(e.length)d(this.handle,e.join("/"),b,c),e.pop()}}};function d(a,b,c,d){var e=a[b],f,g,h,i;if(e)if("all"==c)if("none"==d){for(i in e)if(g=e[i])for(h in g)g[h].forEach(function(a){a(b,c)})}else(g=e["delete"])&&g[d]&&g[d].forEach(function(a){a(b,c)});else if("none"==d)if(g=e[c])for(h in g)g[h].forEach(function(a){a(b,c)});else(g=e[c])&&g[d]&&g[d].forEach(function(a){a(b,c)})}var e=new c;function g(a){if(!a)return a;var b=[Number,String,Boolean],c;if(b.forEach(function(b){a instanceof b&&(c=b(a))}),"undefined"==typeof c)if("[object Array]"===Object.prototype.toString.call(a))c=[],a.forEach(function(a,b,d){c[b]=g(a)});else if("object"==typeof a)if(a.nodeType&&"function"==typeof a.cloneNode)var c=a.cloneNode(!0);else if(a.prototype)c=a;else{c={};for(var d in a)c[d]=g(a[d])}else c=a;return c}function h(){this.dataset={},this.handlers={}}h.prototype={initData:function(b,c){if(c){c=g(c);var d=a(b,this.dataset,1);if(c.constructor==Array)d[c[0]]=c[1];else if(c.constructor==Object)for(var e in c)c.hasOwnProperty(e)&&(d[e]=c[e])}},getDS:function(a){return new f(a,this.dataset)},trigger:function(a,b,c,d){}};function i(){this.routers={},window.addEventListener("hashchange",function(a){j(a)},!1)}function j(a){var b=a.newURL,c=a.oldURL,d;if(window.location.hash&&(d=decodeURI(window.location.hash).substr(1)),d){var e=d.split("/"),f,g,f,h,i;while(i=e.pop())i.indexOf("!")>-1?(g=i.indexOf("!"),f=i.substr(0,g),h=i.substr(g+1)):f=i,l.MD.publish(f,h)}}function k(){this.widget={},this.page={},this.extend={},this.DS=new h,this.MD=new b,new i}k.prototype={Extend:function(a,b){if(a&&(a=a.replace(/\s/gi,""))){var c=a.split(",");while(a=c.pop())if("grace"==a.toLowerCase())for(var d in b)k.prototype[d]=b[d];else{var e=this.extend[a]||(this.extend[a]={});for(var d in b)e[d]=b[d]}}}},window.G||(window.G=new k);var l=window.G;function m(a){this.core=null,this.length=0,this.$(a)}var n=function(a){return new m(a)};n.fn=m.prototype,l.Extend("grace",{Engine:function(a,b){if(a)for(var c in a)n.fn[c]=a[c];if(b)for(var c in b)n[c]=b[c]},$:n}),l.Engine({z_freshCore:function(){var a=0,b=this.core;while(b[a])this[a]=b[a],a++;this.length=b.length}},{extend:function(a){for(var b in a)(function(a,b){n.fn[a]=b})(b,a[b])}});function o(){}var p=Object.create?function(a){return Object.create("function"==typeof a?a.prototype:a||Object.prototype)}:function(a){o.prototype="function"==typeof a?a.prototype:a;var b=new o;return o.prototype=null,b};function q(a){if(!a)throw new Error("Compose arguments must be functions or objects");return a}function r(a,b,c){for(var d,e=b.length;e>c;c++){var f=b[c];if("function"==typeof f){var g=f.prototype;for(var h in g){d=g[h];var i=g.hasOwnProperty(h);if("function"==typeof d&&h in a&&d!==a[h]){var j=a[h];d==x?d=j:i||(s(d,h,A([].slice.call(b,0,c),!0))?d=j:s(j,h,A([f],!0))||console.error("Conflicted method "+h+", final composer must explicitly override with correct method."))}d&&d.install&&i&&!s(j,h,A([f],!0))?d.install.call(a,h):a[h]=d}}else for(var h in q(f)){var d=f[h];if("function"==typeof d){if(d.install){d.install.call(a,h);continue}if(h in a&&d==x)continue}a[h]=d}}return a}z._setMixin=function(a){r=a};function s(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[b]==a)return!0}}function t(a,b){function c(){if(b)return b.apply(this,arguments);throw new Error("Decorator not applied")}return c.install=a,c}z.Decorator=t;function u(a){return function(b){return t(function c(d){var e=this[d];(b=this[d]=e?a(this,e,b):b).install=c},b)}}z.around=u(function(a,b,c){return c.call(a,b)}),z.before=u(function(a,b,c){return function(){var a=c.apply(this,arguments);return a!==v?b.apply(this,a||arguments):void 0}});var v=z.stop={},w;z.after=u(function(a,b,c){return function(){var a=b.apply(this,arguments),d=c.apply(this,arguments);return d===w?a:d}}),z.from=function(a,b){return b?("function"==typeof a?a.prototype:a)[b]:t(function(c){if(!(this[c]="string"==typeof a?this[a]:("function"==typeof a?a.prototype:a)[b||c]))throw new Error("Source method "+b+" was not available to be renamed to "+c)})},z.create=function(a){for(var b=r(p(a),arguments,1),c=arguments.length,d=0;c>d;d++){var e=arguments[d];"function"==typeof e&&(b=e.call(b)||b)}return b};function x(){throw new Error("This method is required and no implementation has been provided")}z.required=x;function y(){var a=[this];return a.push.apply(a,arguments),z.apply(0,a)}function z(a){var b=arguments,c=b.length<2&&"function"!=typeof b[0]?b[0]:r(p(q(a)),b,1);function d(){var a;this instanceof d?a=this:(o.prototype=c,a=new o);for(var b=0;f>b;b++){var g=e[b],h=g.apply(a,arguments);if("object"==typeof h)if(h instanceof d)a=h;else for(var i in h)h.hasOwnProperty(i)&&(a[i]=h[i])}return a}d._getBases=function(a){return a?g:e};var e=A(b),f=e.length;"object"==typeof b[b.length-1]&&(b[b.length-1]=c);var g=A(b,!0);return d.extend=y,z.secure||(c.constructor=d),d.prototype=c,d}z.apply=function(a,b){return a?r(a,b,0):y.apply.call(z,0,b)},z.call=function(a){return r(a,arguments,1)};function A(a,b){var c=[];function d(a,e){a:for(var f=0;f<a.length;f++){var g=a[f],h=b&&"function"==typeof g?g.prototype:g;if(b||"function"==typeof g){var i=e&&g._getBases;if(i)d(i(b));else{for(var j=0;j<c.length;j++)if(h==c[j])continue a;c.push(h)}}}}return d(a,!0),c}function B(a,b){return a.replace(/(^\s*)|(\s*$)/g,"").replace(/\{.*?\}/gi,function(a){return b[a.replace(/\{|\}/gi,"")]})}function C(a,b,c,d){var e=this;function f(){b.apply(this,arguments);for(var f in c)if("init"!=f){var g=l.extend[d.TYPE+"/behavior"][f];g&&(g=g[0],g&&g.call(this,a,c[f],e))}var h=c.init;"page"==d.TYPE&&l.extend[d.TYPE+"/behavior"].init[0].call(this,a,c.init,e)}d.PATH=a;var g=this.extend[d.TYPE];for(var h in g)d[h]=g[h];for(var h in c){var i=l.extend[d.TYPE+"/behavior"][h];i&&(i=i[1],i&&i.call(this,a,c[h],d))}return z(f,d)}l.Extend("grace",{Widget:function(a,b,c,d){d.TYPE="widget",this.widget[a]=C.call(this,a,b,c,d)}}),l.Extend("widget,page",{DS:function(a){return l.DS.getDS(a)},$:function(a){return n(a)},publish:function(a,b){b?l.MD.publish(a,b):l.MD.publish(a)},"new":function(a,b){var c=this.widget[a];return"widget"==this.TYPE&&c&&this.PATH.split("/")[0]==a.split("/")[0]||"widget"!=this.TYPE&&c?new c(b):void 0}}),l.Extend("widget/behavior,page/behavior",{dataset:[function(a,b,c){var d=c.DS;b=g(b),b.constructor==Array&&(b[0]=B(b[0],this)),d.initData(a,b)},function(){}],util:[function(a,b,c){D(b,this)},function(a,b,c){}],event:[function(a,b,c){for(var d in b)F(this,d)},function(a,b,c){for(var d in b)c["zzE_"+d]=b[d]}],subscribe:[function(a,b,c){for(var d in b)E(this,d)},function(a,b,c){for(var d in b)c["zzS_"+d]=b[d]}],init:[function(a,b,c){for(var d in b)b[d].constructor==String?G(this,B(d,this),this[b[d]]):G(this,B(d,this),b[d])},function(a,b,c){}]}),l.Extend("widget/behavior/event,page/behavior/event",{event:function(a,b,c){var d=b.indexOf(" "),e=b.substr(0,d),f=b.substr(d+1).split("@");2==f.length?n(f[0]).on(e,f[1],function(b){a[c](n(this),b)}):1==f.length&&n(f[0]).on(e,function(b){a[c](n(this),b)})}}),l.Extend("widget/behavior/init,page/behavior/init",{dom:function(a,b,c){var d=n(b),e=d.data("set");e.constructor==String&&(e=l.DS.getDS(e)),c.call(a,d,e)}});function D(a,b){var c={},d={};for(var e in a)e=B(e,b),e.indexOf(":")>-1?d[e]=a[e]:c[e]=a[e];l.Util(d,c)}function E(a,b){var c="zzS_"+b;b=B(b,a),a[c].constructor==String&&(c=a[c]),l.MD.subscribe(b,function(b){a[c](b)})}function F(a,b){var c="zzE_"+b;a[c].constructor==String&&(c=a[c]),b=B(b,a);var d=b.indexOf(" "),e=b.indexOf(":");if(d>0&&(e>0&&e>d||-1==e))var f="event";else if(e>0&&(d>0&&d>e||-1==d))var f=b.substr(0,e),b=b.substr(e+1);l.extend[a.TYPE+"/behavior/event"][f](a,b,c)}function G(a,b,c){if(b.indexOf(":")>-1){var d=b.indexOf(":"),e=b.substr(0,d),f=b.substr(d+1),g=l.extend[a.TYPE+"/behavior/init"][e];g?g(a,f,c):l.extend[a.TYPE+"/behavior/init"].dom(a,b,c)}else l.extend[a.TYPE+"/behavior/init"].dom(a,b,c)}return l.Extend("grace",{Page:function(a,b,c,d){d.TYPE="page",this.page[a]=C.call(this,a,b,c,d)}}),l.Extend("page",{init:function(a,b){var c=this.page[a];return"page"==this.TYPE&&c&&this.PATH.split("/")[0]==a.split("/")[0]?new c(b):void 0}}),l.Extend("grace",{Util:function(a,b){n.extend(b);var c=n.dataUtils;for(var d in a)if(d.indexOf(":")>-1){var e=d.split(":");c[e[0]]=c[e[0]]||{},c[e[0]][e[1]]=a[d]}else c.util=c.util||{},c.util[d]=a[d]}}),l.Engine({util:function(a){var b=n.dataUtils;if(a&&a.constructor==String){a=a.replace(/\s/gi,"").split(",");var c,d,e=b.util;while(c=a.pop()){var f=e[c];this.find('[data-util="'+c+'"]').each(function(a){!a[0].inited&&f&&(f(a,a.data("set")),a[0].inited=!0)}).end()}}else for(d in b){var g=b[d];this.find("[data-"+d+"]").each(function(a){var b=a.data(d);!a[0].inited&&g[b]&&(g[b](a,a.data("set")),a[0].inited=!0)}).end()}return this}},{dataUtils:{}}),l.Extend("grace",{App:function(a,b){var c,d;a&&a();for(d in this.page)-1==d.indexOf("/")&&(c=this.page[d],c&&new c);b&&b()}}),l})}("undefined"!=typeof define?define:function(a,b){"undefined"!=typeof module?module.exports=b():window.G=b()});
//# sourceMappingURL=grace.min.map